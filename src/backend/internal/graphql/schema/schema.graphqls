# GraphQL schema for Credfolio2

scalar DateTime
scalar JSON
scalar Upload

"""
A user account in the system.
"""
type User {
  id: ID!
  email: String!
  name: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
An uploaded file stored in object storage.
"""
type File {
  id: ID!
  filename: String!
  contentType: String!
  sizeBytes: Int!
  storageKey: String!
  createdAt: DateTime!
  user: User!
}

"""
Processing status of a reference letter.
"""
enum ReferenceLetterStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

# ============================================================================
# Reference Letter Extraction Schema
# ============================================================================

"""
Relationship type between letter author and candidate.
"""
enum AuthorRelationship {
  MANAGER
  COLLEAGUE
  PROFESSOR
  CLIENT
  MENTOR
  OTHER
}

"""
Skill category classification.
"""
enum SkillCategory {
  TECHNICAL
  SOFT
  DOMAIN
}

"""
Recommendation strength level.
"""
enum RecommendationStrength {
  STRONG
  MODERATE
  RESERVED
}

"""
Author details extracted from a reference letter.
"""
type ExtractedAuthor {
  """The author's full name."""
  name: String!
  """The author's job title or position."""
  title: String
  """The organization where the author works."""
  organization: String
  """The relationship type between author and candidate."""
  relationship: AuthorRelationship!
  """Additional details about the relationship (e.g., 'Direct supervisor for 3 years')."""
  relationshipDetails: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
A skill mentioned in a reference letter.
"""
type ExtractedSkill {
  """The skill name as it appears in the letter."""
  name: String!
  """Normalized skill name for aggregation (e.g., 'JavaScript' and 'JS' both become 'javascript')."""
  normalizedName: String!
  """The category of skill."""
  category: SkillCategory!
  """Number of times this skill was mentioned in the letter."""
  mentions: Int!
  """Contextual quotes where the skill was mentioned."""
  context: [String!]
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
A quality or trait mentioned in a reference letter.
"""
type ExtractedQuality {
  """The quality or trait name."""
  trait: String!
  """Supporting evidence or quotes from the letter."""
  evidence: [String!]
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
An accomplishment cited in a reference letter.
"""
type ExtractedAccomplishment {
  """Description of the accomplishment."""
  description: String!
  """The impact or result of the accomplishment."""
  impact: String
  """When the accomplishment occurred (e.g., '2024', 'Q3 2023')."""
  timeframe: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
Overall recommendation assessment from a reference letter.
"""
type ExtractedRecommendation {
  """The overall strength of the recommendation."""
  strength: RecommendationStrength!
  """Sentiment score from -1.0 (negative) to 1.0 (positive)."""
  sentiment: Float!
  """Key quotes that demonstrate the recommendation strength."""
  keyQuotes: [String!]
  """Brief summary of the recommendation."""
  summary: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
Metadata about the extraction process.
"""
type ExtractionMetadata {
  """When the extraction was performed."""
  extractedAt: DateTime!
  """The LLM model version used for extraction."""
  modelVersion: String!
  """Overall confidence score for the entire extraction (0.0 to 1.0)."""
  overallConfidence: Float!
  """Time taken to process the extraction in milliseconds."""
  processingTimeMs: Int
  """Number of warnings generated during extraction."""
  warningsCount: Int!
  """Warning messages from the extraction process."""
  warnings: [String!]
}

"""
Structured data extracted from a reference letter.
"""
type ExtractedLetterData {
  """Details about the letter's author."""
  author: ExtractedAuthor!
  """Skills mentioned in the letter."""
  skills: [ExtractedSkill!]!
  """Qualities and traits mentioned in the letter."""
  qualities: [ExtractedQuality!]!
  """Accomplishments cited in the letter."""
  accomplishments: [ExtractedAccomplishment!]!
  """Overall recommendation assessment."""
  recommendation: ExtractedRecommendation!
  """Metadata about the extraction process."""
  metadata: ExtractionMetadata!
}

# ============================================================================
# Main Types
# ============================================================================

"""
A reference letter with extracted data.
"""
type ReferenceLetter {
  id: ID!
  title: String
  authorName: String
  authorTitle: String
  organization: String
  dateWritten: DateTime
  rawText: String
  """Structured data extracted from the letter by LLM processing."""
  extractedData: ExtractedLetterData
  status: ReferenceLetterStatus!
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  file: File
}

# ============================================================================
# Resume Extraction Schema
# ============================================================================

"""
Processing status of a resume.
"""
enum ResumeStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

"""
A work experience entry from a resume.
"""
type WorkExperience {
  """Company or organization name."""
  company: String!
  """Job title or position."""
  title: String!
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean!
  """Job description or responsibilities."""
  description: String
}

"""
An education entry from a resume.
"""
type Education {
  """Name of the institution."""
  institution: String!
  """Degree obtained (e.g., 'Bachelor of Science', 'PhD')."""
  degree: String
  """Field of study (e.g., 'Computer Science')."""
  field: String
  """Start date."""
  startDate: String
  """End date or expected graduation."""
  endDate: String
  """GPA if mentioned."""
  gpa: String
  """Notable achievements or honors."""
  achievements: String
}

"""
Structured data extracted from a resume.
"""
type ResumeExtractedData {
  """Full name of the candidate."""
  name: String!
  """Email address."""
  email: String
  """Phone number."""
  phone: String
  """Location (city, state, country)."""
  location: String
  """Professional summary or objective."""
  summary: String
  """Work experience entries."""
  experience: [WorkExperience!]!
  """Education entries."""
  education: [Education!]!
  """Skills list."""
  skills: [String!]!
  """When the extraction was performed."""
  extractedAt: DateTime!
  """Overall confidence score (0.0 to 1.0)."""
  confidence: Float!
}

"""
An uploaded resume with extracted profile data.
"""
type Resume {
  id: ID!
  """Processing status of the resume."""
  status: ResumeStatus!
  """Structured data extracted from the resume by LLM processing."""
  extractedData: ResumeExtractedData
  """Error message if processing failed."""
  errorMessage: String
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  file: File!
}

# ============================================================================
# Profile Schema (Manual Editing)
# ============================================================================

"""
Source of a profile experience entry.
"""
enum ExperienceSource {
  """Manually entered by user."""
  MANUAL
  """Extracted from an uploaded resume."""
  RESUME_EXTRACTED
}

"""
A work experience entry in a user's profile.
Extends WorkExperience with ID for editing and highlights for achievements.
"""
type ProfileExperience {
  """Unique identifier for the experience."""
  id: ID!
  """Company or organization name."""
  company: String!
  """Job title or position."""
  title: String!
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean!
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]!
  """Display order for sorting."""
  displayOrder: Int!
  """Source of this experience entry."""
  source: ExperienceSource!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
An education entry in a user's profile.
Extends Education with ID for editing and source tracking.
"""
type ProfileEducation {
  """Unique identifier for the education entry."""
  id: ID!
  """Institution name."""
  institution: String!
  """Degree or certification."""
  degree: String!
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean!
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
  """Display order for sorting."""
  displayOrder: Int!
  """Source of this education entry."""
  source: ExperienceSource!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
A user's profile containing manually editable data.
"""
type Profile {
  id: ID!
  """The user who owns this profile."""
  user: User!
  """Work experience entries."""
  experiences: [ProfileExperience!]!
  """Education entries."""
  educations: [ProfileEducation!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Input for creating a new work experience.
"""
input CreateExperienceInput {
  """Company or organization name (required)."""
  company: String!
  """Job title or position (required)."""
  title: String!
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean!
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]
}

"""
Input for updating an existing work experience.
"""
input UpdateExperienceInput {
  """Company or organization name."""
  company: String
  """Job title or position."""
  title: String
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]
}

"""
Result of a successful experience operation.
"""
type ExperienceResult {
  """The created or updated experience."""
  experience: ProfileExperience!
}

"""
Error returned when experience validation fails.
"""
type ExperienceValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for experience create/update result.
"""
union ExperienceResponse = ExperienceResult | ExperienceValidationError

"""
Input for creating a new education entry.
"""
input CreateEducationInput {
  """Institution name (required)."""
  institution: String!
  """Degree or certification (required)."""
  degree: String!
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean!
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
}

"""
Input for updating an existing education entry.
"""
input UpdateEducationInput {
  """Institution name."""
  institution: String
  """Degree or certification."""
  degree: String
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
}

"""
Result of a successful education operation.
"""
type EducationResult {
  """The created or updated education entry."""
  education: ProfileEducation!
}

"""
Error returned when education validation fails.
"""
type EducationValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for education create/update result.
"""
union EducationResponse = EducationResult | EducationValidationError

"""
Result of a delete operation.
"""
type DeleteResult {
  """Whether the deletion was successful."""
  success: Boolean!
  """ID of the deleted item."""
  deletedId: ID!
}

type Query {
  """
  Get a user by ID.
  """
  user(id: ID!): User

  """
  Get a file by ID.
  """
  file(id: ID!): File

  """
  Get all files for a user.
  """
  files(userId: ID!): [File!]!

  """
  Get a reference letter by ID.
  """
  referenceLetter(id: ID!): ReferenceLetter

  """
  Get all reference letters for a user.
  """
  referenceLetters(userId: ID!): [ReferenceLetter!]!

  """
  Get a resume by ID.
  """
  resume(id: ID!): Resume

  """
  Get all resumes for a user.
  """
  resumes(userId: ID!): [Resume!]!

  """
  Get a user's profile by user ID.
  Returns null if no profile exists.
  """
  profile(userId: ID!): Profile

  """
  Get a single profile experience by ID.
  """
  profileExperience(id: ID!): ProfileExperience

  """
  Get a single profile education entry by ID.
  """
  profileEducation(id: ID!): ProfileEducation
}

# ============================================================================
# Mutations
# ============================================================================

"""
Result of a file upload operation.
"""
type UploadFileResult {
  """The uploaded file metadata."""
  file: File!
  """The reference letter created for processing."""
  referenceLetter: ReferenceLetter!
}

"""
Error returned when file validation fails.
"""
type FileValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation (e.g., 'contentType', 'size')."""
  field: String!
}

"""
Union type for upload result - either success or validation error.
"""
union UploadFileResponse = UploadFileResult | FileValidationError

"""
Result of a resume upload operation.
"""
type UploadResumeResult {
  """The uploaded file metadata."""
  file: File!
  """The resume created for processing."""
  resume: Resume!
}

"""
Union type for resume upload result - either success or validation error.
"""
union UploadResumeResponse = UploadResumeResult | FileValidationError

type Mutation {
  """
  Upload a reference letter file for processing.
  Accepts PDF, DOCX, or TXT files.
  Creates a file record and queues the document for LLM extraction.
  """
  uploadFile(
    """The user ID uploading the file."""
    userId: ID!
    """The file to upload (PDF, DOCX, or TXT only)."""
    file: Upload!
  ): UploadFileResponse!

  """
  Upload a resume file for processing.
  Accepts PDF, DOCX, or TXT files.
  Creates a file record and queues the resume for LLM extraction.
  """
  uploadResume(
    """The user ID uploading the resume."""
    userId: ID!
    """The resume file to upload (PDF, DOCX, or TXT only)."""
    file: Upload!
  ): UploadResumeResponse!

  # ============================================================================
  # Profile Experience Mutations
  # ============================================================================

  """
  Create a new work experience for a user's profile.
  Creates the profile if it doesn't exist.
  """
  createExperience(
    """The user ID creating the experience."""
    userId: ID!
    """The experience data."""
    input: CreateExperienceInput!
  ): ExperienceResponse!

  """
  Update an existing work experience.
  Only updates fields that are provided.
  """
  updateExperience(
    """The experience ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateExperienceInput!
  ): ExperienceResponse!

  """
  Delete a work experience.
  """
  deleteExperience(
    """The experience ID to delete."""
    id: ID!
  ): DeleteResult!

  # ============================================================================
  # Profile Education Mutations
  # ============================================================================

  """
  Create a new education entry for a user's profile.
  Creates the profile if it doesn't exist.
  """
  createEducation(
    """The user ID creating the education entry."""
    userId: ID!
    """The education data."""
    input: CreateEducationInput!
  ): EducationResponse!

  """
  Update an existing education entry.
  Only updates fields that are provided.
  """
  updateEducation(
    """The education ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateEducationInput!
  ): EducationResponse!

  """
  Delete an education entry.
  """
  deleteEducation(
    """The education ID to delete."""
    id: ID!
  ): DeleteResult!
}
