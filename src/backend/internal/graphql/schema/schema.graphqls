# GraphQL schema for Credfolio2

scalar DateTime
scalar JSON
scalar Upload

"""
A user account in the system.
"""
type User {
  id: ID!
  email: String!
  name: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
An uploaded file stored in object storage.
"""
type File {
  id: ID!
  filename: String!
  contentType: String!
  sizeBytes: Int!
  storageKey: String!
  createdAt: DateTime!
  user: User!
}

"""
Processing status of a reference letter.
"""
enum ReferenceLetterStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

# ============================================================================
# Reference Letter Extraction Schema
# ============================================================================

"""
Relationship type between letter author and candidate.
"""
enum AuthorRelationship {
  MANAGER
  COLLEAGUE
  PROFESSOR
  CLIENT
  MENTOR
  OTHER
}

"""
Skill category classification.
"""
enum SkillCategory {
  TECHNICAL
  SOFT
  DOMAIN
}

"""
Recommendation strength level.
"""
enum RecommendationStrength {
  STRONG
  MODERATE
  RESERVED
}

"""
Author details extracted from a reference letter.
"""
type ExtractedAuthor {
  """The author's full name."""
  name: String!
  """The author's job title or position."""
  title: String
  """The organization where the author works."""
  organization: String
  """The relationship type between author and candidate."""
  relationship: AuthorRelationship!
  """Additional details about the relationship (e.g., 'Direct supervisor for 3 years')."""
  relationshipDetails: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
A skill mentioned in a reference letter.
"""
type ExtractedSkill {
  """The skill name as it appears in the letter."""
  name: String!
  """Normalized skill name for aggregation (e.g., 'JavaScript' and 'JS' both become 'javascript')."""
  normalizedName: String!
  """The category of skill."""
  category: SkillCategory!
  """Number of times this skill was mentioned in the letter."""
  mentions: Int!
  """Contextual quotes where the skill was mentioned."""
  context: [String!]
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
A quality or trait mentioned in a reference letter.
"""
type ExtractedQuality {
  """The quality or trait name."""
  trait: String!
  """Supporting evidence or quotes from the letter."""
  evidence: [String!]
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
An accomplishment cited in a reference letter.
"""
type ExtractedAccomplishment {
  """Description of the accomplishment."""
  description: String!
  """The impact or result of the accomplishment."""
  impact: String
  """When the accomplishment occurred (e.g., '2024', 'Q3 2023')."""
  timeframe: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
Overall recommendation assessment from a reference letter.
"""
type ExtractedRecommendation {
  """The overall strength of the recommendation."""
  strength: RecommendationStrength!
  """Sentiment score from -1.0 (negative) to 1.0 (positive)."""
  sentiment: Float!
  """Key quotes that demonstrate the recommendation strength."""
  keyQuotes: [String!]
  """Brief summary of the recommendation."""
  summary: String
  """Confidence score for this extraction (0.0 to 1.0)."""
  confidence: Float!
}

"""
Metadata about the extraction process.
"""
type ExtractionMetadata {
  """When the extraction was performed."""
  extractedAt: DateTime!
  """The LLM model version used for extraction."""
  modelVersion: String!
  """Overall confidence score for the entire extraction (0.0 to 1.0)."""
  overallConfidence: Float!
  """Time taken to process the extraction in milliseconds."""
  processingTimeMs: Int
  """Number of warnings generated during extraction."""
  warningsCount: Int!
  """Warning messages from the extraction process."""
  warnings: [String!]
}

"""
Structured data extracted from a reference letter.
"""
type ExtractedLetterData {
  """Details about the letter's author."""
  author: ExtractedAuthor!
  """Skills mentioned in the letter."""
  skills: [ExtractedSkill!]!
  """Qualities and traits mentioned in the letter."""
  qualities: [ExtractedQuality!]!
  """Accomplishments cited in the letter."""
  accomplishments: [ExtractedAccomplishment!]!
  """Overall recommendation assessment."""
  recommendation: ExtractedRecommendation!
  """Metadata about the extraction process."""
  metadata: ExtractionMetadata!
}

# ============================================================================
# Main Types
# ============================================================================

"""
A reference letter with extracted data.
"""
type ReferenceLetter {
  id: ID!
  title: String
  authorName: String
  authorTitle: String
  organization: String
  dateWritten: DateTime
  rawText: String
  """Structured data extracted from the letter by LLM processing."""
  extractedData: ExtractedLetterData
  status: ReferenceLetterStatus!
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  file: File
}

type Query {
  """
  Get a user by ID.
  """
  user(id: ID!): User

  """
  Get a file by ID.
  """
  file(id: ID!): File

  """
  Get all files for a user.
  """
  files(userId: ID!): [File!]!

  """
  Get a reference letter by ID.
  """
  referenceLetter(id: ID!): ReferenceLetter

  """
  Get all reference letters for a user.
  """
  referenceLetters(userId: ID!): [ReferenceLetter!]!
}

# ============================================================================
# Mutations
# ============================================================================

"""
Result of a file upload operation.
"""
type UploadFileResult {
  """The uploaded file metadata."""
  file: File!
  """The reference letter created for processing."""
  referenceLetter: ReferenceLetter!
}

"""
Error returned when file validation fails.
"""
type FileValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation (e.g., 'contentType', 'size')."""
  field: String!
}

"""
Union type for upload result - either success or validation error.
"""
union UploadFileResponse = UploadFileResult | FileValidationError

type Mutation {
  """
  Upload a reference letter file for processing.
  Accepts PDF, DOCX, or TXT files.
  Creates a file record and queues the document for LLM extraction.
  """
  uploadFile(
    """The user ID uploading the file."""
    userId: ID!
    """The file to upload (PDF, DOCX, or TXT only)."""
    file: Upload!
  ): UploadFileResponse!
}
