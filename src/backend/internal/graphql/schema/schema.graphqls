# GraphQL schema for Credfolio2

scalar DateTime
scalar JSON
scalar Upload

"""
A user account in the system.
"""
type User {
  id: ID!
  email: String!
  name: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
An uploaded file stored in object storage.
"""
type File {
  id: ID!
  filename: String!
  contentType: String!
  sizeBytes: Int!
  storageKey: String!
  """SHA-256 hash of the file content for duplicate detection."""
  contentHash: String
  """Presigned URL for downloading the file. Expires after a short time."""
  url: String!
  createdAt: DateTime!
  user: User!
}

"""
Processing status of a reference letter.
"""
enum ReferenceLetterStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  APPLIED
}

# ============================================================================
# Reference Letter Extraction Schema (Credibility-Focused)
# ============================================================================

"""
Relationship type between letter author and candidate.
"""
enum AuthorRelationship {
  MANAGER
  PEER
  DIRECT_REPORT
  CLIENT
  MENTOR
  PROFESSOR
  COLLEAGUE
  OTHER
}

"""
Skill category classification.
"""
enum SkillCategory {
  TECHNICAL
  SOFT
  DOMAIN
}

"""
Author details extracted from a reference letter.
"""
type ExtractedAuthor {
  """The author's full name."""
  name: String!
  """The author's job title or position."""
  title: String
  """The company where the author works."""
  company: String
  """The relationship type between author and candidate."""
  relationship: AuthorRelationship!
}

"""
A testimonial quote suitable for display on the profile.
"""
type ExtractedTestimonial {
  """The full quote text."""
  quote: String!
  """Skills mentioned in this testimonial."""
  skillsMentioned: [String!]
}

"""
A specific skill mentioned in the reference letter with context.
"""
type ExtractedSkillMention {
  """The skill name."""
  skill: String!
  """Quote from the letter mentioning this skill."""
  quote: String!
  """Context for the skill mention (e.g., 'technical skills', 'leadership')."""
  context: String
}

"""
A reference to a role/company mentioned in the letter.
"""
type ExtractedExperienceMention {
  """Company name mentioned."""
  company: String!
  """Role/title mentioned."""
  role: String!
  """Quote from the letter about this experience."""
  quote: String!
}

"""
Metadata about the extraction process.
"""
type ExtractionMetadata {
  """When the extraction was performed."""
  extractedAt: DateTime!
  """The LLM model version used for extraction."""
  modelVersion: String!
  """Time taken to process the extraction in milliseconds."""
  processingTimeMs: Int
}

"""
A skill discovered in a reference letter that may not be on the profile.
"""
type DiscoveredSkill {
  """The skill name."""
  skill: String!
  """Quote from the letter mentioning this skill."""
  quote: String!
  """Context for the skill mention (e.g., 'technical skills', 'leadership')."""
  context: String
}

"""
Structured data extracted from a reference letter for credibility validation.
"""
type ExtractedLetterData {
  """Details about the letter's author."""
  author: ExtractedAuthor!
  """Full testimonial quotes for display."""
  testimonials: [ExtractedTestimonial!]!
  """Specific skill mentions with quotes."""
  skillMentions: [ExtractedSkillMention!]!
  """Experience/role mentions with quotes."""
  experienceMentions: [ExtractedExperienceMention!]!
  """Skills discovered in the letter that aren't in the profile yet (with attribution)."""
  discoveredSkills: [DiscoveredSkill!]!
  """Metadata about the extraction process."""
  metadata: ExtractionMetadata!
}

# ============================================================================
# Document Content Detection Schema
# ============================================================================

"""
Hint about the document type from lightweight detection.
"""
enum DocumentTypeHint {
  RESUME
  REFERENCE_LETTER
  HYBRID
  UNKNOWN
}

"""
Result of lightweight document content detection.
Used to quickly classify a document before running full extraction.
"""
type DocumentDetectionResult {
  """Whether the document contains career information (resume/CV content)."""
  hasCareerInfo: Boolean!
  """Whether the document contains testimonial/recommendation content."""
  hasTestimonial: Boolean!
  """Name of the testimonial author (person who wrote the recommendation), if detected."""
  testimonialAuthor: String
  """Confidence in the detection (0.0 to 1.0)."""
  confidence: Float!
  """Brief summary of what was found in the document."""
  summary: String!
  """Hint about the document type."""
  documentTypeHint: DocumentTypeHint!
  """ID of the stored file for subsequent processing."""
  fileId: ID!
}

"""
Result of a successful document upload for detection.
Returns the file ID for polling detection status.
"""
type UploadForDetectionResult {
  """The ID of the uploaded file."""
  fileId: ID!
}

"""
Union type for upload for detection result.
"""
union UploadForDetectionResponse = UploadForDetectionResult | FileValidationError

"""
Status of asynchronous document detection.
"""
enum DetectionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

"""
Status of a document detection job.
Poll this query to track detection progress after uploadForDetection.
"""
type DocumentDetectionStatus {
  """The file ID being detected."""
  fileId: ID!
  """Current detection status."""
  status: DetectionStatus!
  """Detection results, available when status is COMPLETED."""
  detection: DocumentDetectionResult
  """Error message, set when status is FAILED."""
  error: String
}

# ============================================================================
# Main Types
# ============================================================================

"""
A reference letter with extracted data.
"""
type ReferenceLetter {
  id: ID!
  title: String
  authorName: String
  authorTitle: String
  organization: String
  dateWritten: DateTime
  rawText: String
  """Structured data extracted from the letter by LLM processing."""
  extractedData: ExtractedLetterData
  status: ReferenceLetterStatus!
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  file: File
}

# ============================================================================
# Resume Extraction Schema
# ============================================================================

"""
Processing status of a resume.
"""
enum ResumeStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

"""
Structured data extracted from a resume.
Education and work experience are materialized into profile tables
and exposed via ProfileEducation/ProfileExperience types.
"""
type ResumeExtractedData {
  """Full name of the candidate."""
  name: String!
  """Email address."""
  email: String
  """Phone number."""
  phone: String
  """Location (city, state, country)."""
  location: String
  """Professional summary or objective."""
  summary: String
  """When the extraction was performed."""
  extractedAt: DateTime!
  """Overall confidence score (0.0 to 1.0)."""
  confidence: Float!
}

"""
An uploaded resume with extracted profile data.
"""
type Resume {
  id: ID!
  """Processing status of the resume."""
  status: ResumeStatus!
  """Structured data extracted from the resume by LLM processing."""
  extractedData: ResumeExtractedData
  """Error message if processing failed."""
  errorMessage: String
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  file: File!
}

# ============================================================================
# Profile Schema (Manual Editing)
# ============================================================================

"""
Source of a profile experience entry.
"""
enum ExperienceSource {
  """Manually entered by user."""
  MANUAL
  """Extracted from an uploaded resume."""
  RESUME_EXTRACTED
}

"""
A work experience entry in a user's profile.
"""
type ProfileExperience {
  """Unique identifier for the experience."""
  id: ID!
  """Company or organization name."""
  company: String!
  """Job title or position."""
  title: String!
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean!
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]!
  """Display order for sorting."""
  displayOrder: Int!
  """Source of this experience entry."""
  source: ExperienceSource!
  """Number of reference letters validating this experience."""
  validationCount: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
An education entry in a user's profile.
"""
type ProfileEducation {
  """Unique identifier for the education entry."""
  id: ID!
  """Institution name."""
  institution: String!
  """Degree or certification."""
  degree: String!
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean!
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
  """Display order for sorting."""
  displayOrder: Int!
  """Source of this education entry."""
  source: ExperienceSource!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
A skill entry in a user's profile.
"""
type ProfileSkill {
  """Unique identifier for the skill."""
  id: ID!
  """Skill name as displayed."""
  name: String!
  """Normalized skill name for deduplication."""
  normalizedName: String!
  """Skill category."""
  category: SkillCategory!
  """Display order for sorting."""
  displayOrder: Int!
  """Source of this skill entry."""
  source: ExperienceSource!
  """Number of reference letters validating this skill."""
  validationCount: Int!
  """The reference letter this skill was discovered from (if source is reference letter)."""
  sourceReferenceLetter: ReferenceLetter
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
A user's profile containing manually editable data.
"""
type Profile {
  id: ID!
  """The user who owns this profile."""
  user: User!
  """User-edited name (overrides resume extraction if set)."""
  name: String
  """User-edited email (overrides resume extraction if set)."""
  email: String
  """User-edited phone (overrides resume extraction if set)."""
  phone: String
  """User-edited location (overrides resume extraction if set)."""
  location: String
  """User-edited professional summary (overrides resume extraction if set)."""
  summary: String
  """URL to the user's profile photo (presigned URL for direct access)."""
  profilePhotoUrl: String
  """Work experience entries."""
  experiences: [ProfileExperience!]!
  """Education entries."""
  educations: [ProfileEducation!]!
  """Skill entries."""
  skills: [ProfileSkill!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Input for creating a new work experience.
"""
input CreateExperienceInput {
  """Company or organization name (required)."""
  company: String!
  """Job title or position (required)."""
  title: String!
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean!
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]
}

"""
Input for updating an existing work experience.
"""
input UpdateExperienceInput {
  """Company or organization name."""
  company: String
  """Job title or position."""
  title: String
  """Location of the job."""
  location: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether this is the current job."""
  isCurrent: Boolean
  """Job description or responsibilities."""
  description: String
  """Key achievements or highlights (bullet points)."""
  highlights: [String!]
}

"""
Result of a successful experience operation.
"""
type ExperienceResult {
  """The created or updated experience."""
  experience: ProfileExperience!
}

"""
Error returned when experience validation fails.
"""
type ExperienceValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for experience create/update result.
"""
union ExperienceResponse = ExperienceResult | ExperienceValidationError

"""
Input for creating a new education entry.
"""
input CreateEducationInput {
  """Institution name (required)."""
  institution: String!
  """Degree or certification (required)."""
  degree: String!
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean!
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
}

"""
Input for updating an existing education entry.
"""
input UpdateEducationInput {
  """Institution name."""
  institution: String
  """Degree or certification."""
  degree: String
  """Field of study."""
  field: String
  """Start date (e.g., 'Jan 2020', '2020')."""
  startDate: String
  """End date (e.g., 'Dec 2023', 'Present')."""
  endDate: String
  """Whether currently studying here."""
  isCurrent: Boolean
  """Description or achievements."""
  description: String
  """GPA if applicable."""
  gpa: String
}

"""
Result of a successful education operation.
"""
type EducationResult {
  """The created or updated education entry."""
  education: ProfileEducation!
}

"""
Error returned when education validation fails.
"""
type EducationValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for education create/update result.
"""
union EducationResponse = EducationResult | EducationValidationError

"""
Input for creating a new skill.
"""
input CreateSkillInput {
  """Skill name (required)."""
  name: String!
  """Skill category (required)."""
  category: SkillCategory!
}

"""
Input for updating an existing skill.
"""
input UpdateSkillInput {
  """Skill name."""
  name: String
  """Skill category."""
  category: SkillCategory
}

"""
Result of a successful skill operation.
"""
type SkillResult {
  """The created or updated skill."""
  skill: ProfileSkill!
}

"""
Error returned when skill validation fails.
"""
type SkillValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for skill create/update result.
"""
union SkillResponse = SkillResult | SkillValidationError

"""
Input for updating profile header fields.
"""
input UpdateProfileHeaderInput {
  """Name to display."""
  name: String
  """Email address."""
  email: String
  """Phone number."""
  phone: String
  """Location (city, state, country)."""
  location: String
  """Professional summary."""
  summary: String
}

"""
Result of a successful profile header update.
"""
type ProfileHeaderResult {
  """The updated profile."""
  profile: Profile!
}

"""
Error returned when profile header validation fails.
"""
type ProfileHeaderValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for profile header update result.
"""
union ProfileHeaderResponse = ProfileHeaderResult | ProfileHeaderValidationError

"""
Result of a successful profile photo upload.
"""
type UploadProfilePhotoResult {
  """The updated profile with photo URL."""
  profile: Profile!
}

"""
Union type for profile photo upload result.
"""
union UploadProfilePhotoResponse = UploadProfilePhotoResult | FileValidationError

"""
Result of deleting a profile photo.
"""
type DeleteProfilePhotoResult {
  """Whether the deletion was successful."""
  success: Boolean!
}

"""
Union type for profile photo deletion result.
"""
union DeleteProfilePhotoResponse = DeleteProfilePhotoResult | ProfileHeaderValidationError

"""
Result of a successful author image upload.
"""
type UploadAuthorImageResult {
  """The uploaded file metadata."""
  file: File!
  """The updated author with image URL."""
  author: Author!
}

"""
Union type for author image upload result.
"""
union UploadAuthorImageResponse = UploadAuthorImageResult | FileValidationError

"""
Result of a delete operation.
"""
type DeleteResult {
  """Whether the deletion was successful."""
  success: Boolean!
  """ID of the deleted item."""
  deletedId: ID!
}

# ============================================================================
# Apply Reference Letter Validations
# ============================================================================

"""
Input for applying a skill validation from a reference letter.
"""
input SkillValidationInput {
  """The profile skill ID to validate."""
  profileSkillID: ID!
  """Quote snippet from the reference letter supporting this skill."""
  quoteSnippet: String!
}

"""
Input for applying an experience validation from a reference letter.
"""
input ExperienceValidationInput {
  """The profile experience ID to validate."""
  profileExperienceID: ID!
  """Quote snippet from the reference letter supporting this experience."""
  quoteSnippet: String!
}

"""
Input for creating a testimonial from a reference letter.
"""
input TestimonialInput {
  """The full quote text for the testimonial."""
  quote: String!
  """Skills mentioned in this testimonial."""
  skillsMentioned: [String!]!
}

"""
Input for adding a new skill discovered in the reference letter.
"""
input NewSkillInput {
  """The skill name."""
  name: String!
  """The skill category."""
  category: SkillCategory!
  """Quote context from the reference letter mentioning this skill."""
  quoteContext: String
}

"""
Input for applying selected validations from a reference letter.
"""
input ApplyValidationsInput {
  """The reference letter ID to apply validations from."""
  referenceLetterID: ID!
  """Skill validations to apply."""
  skillValidations: [SkillValidationInput!]!
  """Experience validations to apply."""
  experienceValidations: [ExperienceValidationInput!]!
  """Testimonials to add to the profile."""
  testimonials: [TestimonialInput!]!
  """New skills discovered in the reference letter to add to the profile."""
  newSkills: [NewSkillInput!]!
}

"""
Counts of items applied from a reference letter.
"""
type AppliedCount {
  """Number of skill validations applied."""
  skillValidations: Int!
  """Number of experience validations applied."""
  experienceValidations: Int!
  """Number of testimonials added."""
  testimonials: Int!
  """Number of new skills added."""
  newSkills: Int!
}

"""
Result of applying reference letter validations.
"""
type ApplyValidationsResult {
  """The updated reference letter."""
  referenceLetter: ReferenceLetter!
  """The updated profile."""
  profile: Profile!
  """Counts of items that were applied."""
  appliedCount: AppliedCount!
}

"""
Error returned when applying validations fails.
"""
type ApplyValidationsError {
  """Error message describing the failure."""
  message: String!
  """The field that caused the error, if applicable."""
  field: String
}

"""
Union type for apply validations result.
"""
union ApplyValidationsResponse = ApplyValidationsResult | ApplyValidationsError

# ============================================================================
# Author Type
# ============================================================================

"""
A person who provided testimonials for the profile. Authors are deduplicated
by name and company within a profile.
"""
type Author {
  """Unique identifier for the author."""
  id: ID!
  """Name of the author."""
  name: String!
  """Title/position of the author."""
  title: String
  """Company/organization of the author."""
  company: String
  """LinkedIn profile URL of the author."""
  linkedInUrl: String
  """Presigned URL for the author's profile image."""
  imageUrl: String
  """When the author record was created."""
  createdAt: DateTime!
  """When the author record was last updated."""
  updatedAt: DateTime!
  """All testimonials from this author."""
  testimonials: [Testimonial!]!
}

"""
Input for updating an author's information.
"""
input UpdateAuthorInput {
  """Updated name of the author."""
  name: String
  """Updated title/position of the author."""
  title: String
  """Updated company/organization of the author."""
  company: String
  """Updated LinkedIn profile URL of the author."""
  linkedInUrl: String
  """ID of the uploaded image file for the author's profile picture."""
  imageId: ID
}

# ============================================================================
# Testimonial Type
# ============================================================================

"""
Relationship type between testimonial author and the profile owner.
"""
enum TestimonialRelationship {
  MANAGER
  PEER
  DIRECT_REPORT
  CLIENT
  OTHER
}

"""
A testimonial quote from a reference letter displayed on the profile.
"""
type Testimonial {
  """Unique identifier for the testimonial."""
  id: ID!
  """The full quote text."""
  quote: String!
  """The author who provided this testimonial."""
  author: Author
  """Name of the person who provided the testimonial. (Deprecated: use author.name)"""
  authorName: String!
  """Title/position of the author. (Deprecated: use author.title)"""
  authorTitle: String
  """Company/organization of the author. (Deprecated: use author.company)"""
  authorCompany: String
  """Relationship between the author and the profile owner."""
  relationship: TestimonialRelationship!
  """The reference letter this testimonial was extracted from."""
  referenceLetter: ReferenceLetter
  """When the testimonial was created."""
  createdAt: DateTime!
  """Skills validated by this testimonial's reference letter."""
  validatedSkills: [ProfileSkill!]!
}

# ============================================================================
# Validation Types for Credibility Indicators
# ============================================================================

"""
A validation record linking a skill to a reference letter.
"""
type SkillValidation {
  """Unique identifier for the validation."""
  id: ID!
  """The skill being validated."""
  skill: ProfileSkill!
  """The reference letter providing the validation."""
  referenceLetter: ReferenceLetter!
  """The specific testimonial that validates this skill (if applicable)."""
  testimonial: Testimonial
  """Quote snippet from the reference letter supporting this skill."""
  quoteSnippet: String
  """When the validation was created."""
  createdAt: DateTime!
}

"""
A validation record linking an experience to a reference letter.
"""
type ExperienceValidation {
  """Unique identifier for the validation."""
  id: ID!
  """The experience being validated."""
  experience: ProfileExperience!
  """The reference letter providing the validation."""
  referenceLetter: ReferenceLetter!
  """Quote snippet from the reference letter supporting this experience."""
  quoteSnippet: String
  """When the validation was created."""
  createdAt: DateTime!
}

# ============================================================================
# Unified Document Processing Schema
# ============================================================================

"""
Input for processing a previously uploaded document.
The fileId must reference a file previously stored via uploadForDetection.
"""
input ProcessDocumentInput {
  """ID of the file already stored via uploadForDetection."""
  fileId: ID!
  """Whether to extract career/resume information from the document."""
  extractCareerInfo: Boolean!
  """Whether to extract testimonial/reference letter content from the document."""
  extractTestimonial: Boolean!
}

"""
IDs of the entities created for tracking extraction progress.
"""
type ProcessDocumentResult {
  """Resume ID created for career info extraction (null if not requested)."""
  resumeId: ID
  """Reference letter ID created for testimonial extraction (null if not requested)."""
  referenceLetterID: ID
}

"""
Error returned when process document validation fails.
"""
type ProcessDocumentError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation."""
  field: String
}

"""
Union type for process document result.
"""
union ProcessDocumentResponse = ProcessDocumentResult | ProcessDocumentError

"""
Aggregated processing status across resume and reference letter extraction.
"""
type DocumentProcessingStatus {
  """Resume processing status (null if resume extraction was not requested)."""
  resume: Resume
  """Reference letter processing status (null if letter extraction was not requested)."""
  referenceLetter: ReferenceLetter
  """Overall status: true when all requested extractions are complete (COMPLETED or FAILED)."""
  allComplete: Boolean!
}

"""
Input for importing extracted document results into profile tables.
"""
input ImportDocumentResultsInput {
  """Resume ID to materialize into profile (null to skip)."""
  resumeId: ID
  """Reference letter ID whose validations should be applied (null to skip)."""
  referenceLetterID: ID
}

"""
Counts of items imported into the profile.
"""
type ImportedCount {
  """Number of work experiences materialized."""
  experiences: Int!
  """Number of education entries materialized."""
  educations: Int!
  """Number of skills materialized."""
  skills: Int!
  """Number of testimonials materialized from reference letters."""
  testimonials: Int!
}

"""
Result of importing document results into profile tables.
"""
type ImportDocumentResultsResult {
  """The updated profile after materialization."""
  profile: Profile!
  """Counts of items that were imported."""
  importedCount: ImportedCount!
}

"""
Error returned when import document results validation fails.
"""
type ImportDocumentResultsError {
  """Error message describing the failure."""
  message: String!
  """The field that caused the error."""
  field: String
}

"""
Union type for import document results.
"""
union ImportDocumentResultsResponse = ImportDocumentResultsResult | ImportDocumentResultsError

"""
The type of feedback being reported about document processing.
"""
enum DocumentFeedbackType {
  """Feedback about incorrect document type detection."""
  DETECTION_CORRECTION
  """Feedback about extraction quality issues."""
  EXTRACTION_QUALITY
}

"""
Input for reporting feedback about document detection or extraction.
"""
input DocumentFeedbackInput {
  """ID of the file the feedback relates to."""
  fileId: ID!
  """The type of feedback being reported."""
  feedbackType: DocumentFeedbackType!
  """Free-text message describing the issue."""
  message: String!
}

"""
Result of reporting document feedback.
"""
type DocumentFeedbackResult {
  """Whether the feedback was recorded successfully."""
  success: Boolean!
}

type Query {
  """
  Get a user by ID.
  """
  user(id: ID!): User

  """
  Get a file by ID.
  """
  file(id: ID!): File

  """
  Get all files for a user.
  """
  files(userId: ID!): [File!]!

  """
  Get a reference letter by ID.
  """
  referenceLetter(id: ID!): ReferenceLetter

  """
  Get all reference letters for a user.
  """
  referenceLetters(userId: ID!): [ReferenceLetter!]!

  """
  Get a resume by ID.
  """
  resume(id: ID!): Resume

  """
  Get all resumes for a user.
  """
  resumes(userId: ID!): [Resume!]!

  """
  Get a profile by its ID.
  Returns null if no profile exists.
  """
  profile(id: ID!): Profile

  """
  Get a user's profile by user ID.
  Returns null if no profile exists.
  """
  profileByUserId(userId: ID!): Profile

  """
  Get a single profile experience by ID.
  """
  profileExperience(id: ID!): ProfileExperience

  """
  Get a single profile education entry by ID.
  """
  profileEducation(id: ID!): ProfileEducation

  """
  Get a single profile skill by ID.
  """
  profileSkill(id: ID!): ProfileSkill

  """
  Get all testimonials for a profile.
  """
  testimonials(profileId: ID!): [Testimonial!]!

  """
  Get an author by ID.
  """
  author(id: ID!): Author

  """
  Get all authors for a profile.
  """
  authors(profileId: ID!): [Author!]!

  """
  Get all validations for a specific skill.
  """
  skillValidations(skillId: ID!): [SkillValidation!]!

  """
  Get all validations for a specific experience.
  """
  experienceValidations(experienceId: ID!): [ExperienceValidation!]!

  """
  Check if a file with the given content hash already exists for the user.
  Returns the existing file and associated resume/reference letter if found.
  Used for pre-upload duplicate detection.
  """
  checkDuplicateFile(userId: ID!, contentHash: String!): DuplicateFileDetected

  """
  Get the processing status of a document.
  Provide the resume ID and/or reference letter ID returned by processDocument.
  Returns aggregated status across all requested extractions.
  """
  documentProcessingStatus(resumeId: ID, referenceLetterID: ID): DocumentProcessingStatus

  """
  Get the detection status for an uploaded document.
  Poll this after uploadForDetection to get detection results.
  """
  documentDetectionStatus(fileId: ID!): DocumentDetectionStatus
}

# ============================================================================
# Mutations
# ============================================================================

"""
Result of a file upload operation.
"""
type UploadFileResult {
  """The uploaded file metadata."""
  file: File!
  """The reference letter created for processing."""
  referenceLetter: ReferenceLetter!
}

"""
Error returned when file validation fails.
"""
type FileValidationError {
  """Error message describing the validation failure."""
  message: String!
  """The field that failed validation (e.g., 'contentType', 'size')."""
  field: String!
}

"""
Result when a duplicate file is detected during upload.
"""
type DuplicateFileDetected {
  """The existing file that matches the uploaded content."""
  existingFile: File!
  """The existing resume created from this file (if uploading a resume)."""
  existingResume: Resume
  """The existing reference letter created from this file (if uploading a reference letter)."""
  existingReferenceLetter: ReferenceLetter
  """Message describing the duplicate detection."""
  message: String!
}

"""
Union type for upload result - either success, validation error, or duplicate detected.
"""
union UploadFileResponse = UploadFileResult | FileValidationError | DuplicateFileDetected

"""
Result of a resume upload operation.
"""
type UploadResumeResult {
  """The uploaded file metadata."""
  file: File!
  """The resume created for processing."""
  resume: Resume!
}

"""
Union type for resume upload result - either success, validation error, or duplicate detected.
"""
union UploadResumeResponse = UploadResumeResult | FileValidationError | DuplicateFileDetected

type Mutation {
  """
  Upload a reference letter file for processing.
  Accepts PDF, DOCX, or TXT files.
  Creates a file record and queues the document for LLM extraction.
  If a file with the same content hash already exists, returns DuplicateFileDetected
  unless forceReimport is true.
  """
  uploadFile(
    """The user ID uploading the file."""
    userId: ID!
    """The file to upload (PDF, DOCX, or TXT only)."""
    file: Upload!
    """If true, proceed with upload even if a duplicate is detected."""
    forceReimport: Boolean
  ): UploadFileResponse!

  """
  Upload a resume file for processing.
  Accepts PDF, DOCX, or TXT files.
  Creates a file record and queues the resume for LLM extraction.
  If a file with the same content hash already exists, returns DuplicateFileDetected
  unless forceReimport is true.
  """
  uploadResume(
    """The user ID uploading the resume."""
    userId: ID!
    """The resume file to upload (PDF, DOCX, or TXT only)."""
    file: Upload!
    """If true, proceed with upload even if a duplicate is detected."""
    forceReimport: Boolean
  ): UploadResumeResponse!

  # ============================================================================
  # Document Content Detection
  # ============================================================================

  """
  Upload a document and start asynchronous content detection.
  Stores the file and enqueues a background detection job.
  Poll documentDetectionStatus to get detection results.
  """
  uploadForDetection(
    """The user ID uploading the document."""
    userId: ID!
    """The document file to analyze (PDF, DOCX, or TXT only)."""
    file: Upload!
  ): UploadForDetectionResponse!

  # ============================================================================
  # Unified Document Processing
  # ============================================================================

  """
  Start processing a previously uploaded document for extraction.
  The file must already exist (created via uploadForDetection).
  Creates resume and/or reference letter records as needed, enqueues extraction,
  and returns IDs for polling via documentProcessingStatus.
  At least one of extractCareerInfo or extractTestimonial must be true.
  """
  processDocument(
    """The user ID requesting processing."""
    userId: ID!
    """Processing options specifying what to extract."""
    input: ProcessDocumentInput!
  ): ProcessDocumentResponse!

  """
  Import extracted document results into profile tables.
  Materializes resume data (experiences, education, skills) and/or applies
  reference letter validations. The referenced entities must be in COMPLETED status.
  """
  importDocumentResults(
    """The user ID importing the results."""
    userId: ID!
    """Which document results to import."""
    input: ImportDocumentResultsInput!
  ): ImportDocumentResultsResponse!

  """
  Report feedback about document detection or extraction quality.
  Feedback is logged for analysis; no table is created for MVP.
  """
  reportDocumentFeedback(
    """The user ID reporting the feedback."""
    userId: ID!
    """The feedback details."""
    input: DocumentFeedbackInput!
  ): DocumentFeedbackResult!

  # ============================================================================
  # Profile Header Mutations
  # ============================================================================

  """
  Update the profile header fields (name, email, phone, location, summary).
  Creates the profile if it doesn't exist.
  Only updates fields that are provided.
  """
  updateProfileHeader(
    """The user ID whose profile to update."""
    userId: ID!
    """The header fields to update."""
    input: UpdateProfileHeaderInput!
  ): ProfileHeaderResponse!

  """
  Upload a profile photo.
  Accepts JPEG, PNG, GIF, or WebP images (max 5MB).
  Creates the profile if it doesn't exist.
  Returns the updated profile with the photo URL.
  """
  uploadProfilePhoto(
    """The user ID uploading the photo."""
    userId: ID!
    """The image file to upload (JPEG, PNG, GIF, or WebP only)."""
    file: Upload!
  ): UploadProfilePhotoResponse!

  """
  Delete the profile photo.
  """
  deleteProfilePhoto(
    """The user ID whose photo to delete."""
    userId: ID!
  ): DeleteProfilePhotoResponse!

  # ============================================================================
  # Profile Experience Mutations
  # ============================================================================

  """
  Create a new work experience for a user's profile.
  Creates the profile if it doesn't exist.
  """
  createExperience(
    """The user ID creating the experience."""
    userId: ID!
    """The experience data."""
    input: CreateExperienceInput!
  ): ExperienceResponse!

  """
  Update an existing work experience.
  Only updates fields that are provided.
  """
  updateExperience(
    """The experience ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateExperienceInput!
  ): ExperienceResponse!

  """
  Delete a work experience.
  """
  deleteExperience(
    """The experience ID to delete."""
    id: ID!
  ): DeleteResult!

  # ============================================================================
  # Profile Education Mutations
  # ============================================================================

  """
  Create a new education entry for a user's profile.
  Creates the profile if it doesn't exist.
  """
  createEducation(
    """The user ID creating the education entry."""
    userId: ID!
    """The education data."""
    input: CreateEducationInput!
  ): EducationResponse!

  """
  Update an existing education entry.
  Only updates fields that are provided.
  """
  updateEducation(
    """The education ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateEducationInput!
  ): EducationResponse!

  """
  Delete an education entry.
  """
  deleteEducation(
    """The education ID to delete."""
    id: ID!
  ): DeleteResult!

  # ============================================================================
  # Profile Skill Mutations
  # ============================================================================

  """
  Create a new skill for a user's profile.
  Creates the profile if it doesn't exist.
  """
  createSkill(
    """The user ID creating the skill."""
    userId: ID!
    """The skill data."""
    input: CreateSkillInput!
  ): SkillResponse!

  """
  Update an existing skill.
  Only updates fields that are provided.
  """
  updateSkill(
    """The skill ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateSkillInput!
  ): SkillResponse!

  """
  Delete a skill.
  """
  deleteSkill(
    """The skill ID to delete."""
    id: ID!
  ): DeleteResult!

  # ============================================================================
  # Reference Letter Validations
  # ============================================================================

  """
  Apply selected validations from a reference letter to the profile.
  Creates skill validations, experience validations, testimonials, and new skills.
  Updates the reference letter status to indicate validations have been applied.
  """
  applyReferenceLetterValidations(
    """The user ID applying the validations."""
    userId: ID!
    """The validations to apply."""
    input: ApplyValidationsInput!
  ): ApplyValidationsResponse!

  # ============================================================================
  # Author Mutations
  # ============================================================================

  """
  Upload an author's profile image.
  Accepts JPEG, PNG, GIF, or WebP images (max 5MB).
  Updates the author record with the new image.
  Returns the updated author with image URL.
  """
  uploadAuthorImage(
    """The author ID to upload the image for."""
    authorId: ID!
    """The image file to upload (JPEG, PNG, GIF, or WebP only)."""
    file: Upload!
  ): UploadAuthorImageResponse!

  """
  Update an author's information.
  Allows correcting author details and adding LinkedIn profile links.
  """
  updateAuthor(
    """The author ID to update."""
    id: ID!
    """The fields to update."""
    input: UpdateAuthorInput!
  ): Author!

  # ============================================================================
  # Testimonial Mutations
  # ============================================================================

  """
  Delete a testimonial.
  """
  deleteTestimonial(
    """The testimonial ID to delete."""
    id: ID!
  ): DeleteResult!
}
